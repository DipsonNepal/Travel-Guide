<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Wanderly Nepal — Top Destinations</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <style>
    :root{
      --bg:#071224; --card:#0b1220; --muted:#9aa4b2; --accent:#ff7a59; --glass: rgba(255,255,255,0.04);
      --light-bg:#f7fafc; --light-card:#ffffff; --text:#e6eef6; --radius:14px;
    }
    [data-theme="light"]{--bg:var(--light-bg); --card:var(--light-card); --muted:#556070; --accent:#0ea5a0; --glass: rgba(15,23,36,0.04); --text:#0b1220}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial; background:linear-gradient(180deg,var(--bg),#031322); color:var(--text);}
    .wrap{max-width:1200px;margin:24px auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:10px;background: linear-gradient(135deg,var(--accent),#ffd166);display:flex;align-items:center;justify-content:center;font-weight:700;color:#03111a}
    nav a{color:var(--muted);text-decoration:none;margin-left:16px}
    .hero{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-top:18px}
    .hero-left{border-radius:var(--radius);overflow:hidden;position:relative}
    .slideshow{height:420px;display:flex;align-items:center;justify-content:center;position:relative}
    .slide{position:absolute;inset:0;background-size:cover;background-position:center;transition:opacity .8s ease;opacity:0}
    .slide.show{opacity:1}
    .hero-overlay{position:absolute;left:24px;bottom:24px;color:white;text-shadow:0 6px 20px rgba(0,0,0,0.6)}
    .searchbar{display:flex;gap:8px;background:var(--glass);backdrop-filter: blur(6px);padding:12px;border-radius:12px}
    .searchbar input{flex:1;padding:10px 12px;border-radius:10px;border:0;background:transparent;color:var(--text);outline:none}
    .search-results{position:absolute;left:24px;bottom:84px;background:var(--card);padding:10px;border-radius:10px;max-height:220px;overflow:auto;width:320px;box-shadow:0 10px 30px rgba(0,0,0,0.45)}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(2,6,23,0.7)}
    .quick-links{display:flex;gap:8px;flex-wrap:wrap}
    .quick-links button{background:transparent;border:1px dashed rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:var(--text);cursor:pointer}
    .filters{display:flex;gap:8px;flex-wrap:wrap;margin-top:18px}
    .filters select,.filters button{padding:10px;border-radius:10px;border:0;background:var(--glass);color:var(--text)}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;margin-top:18px}
    .card-dest{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:12px;overflow:hidden}
    .card-dest img{width:100%;height:140px;object-fit:cover}
    .card-body{padding:12px}
    .tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .tag{font-size:12px;padding:6px 8px;border-radius:999px;background:rgba(0,0,0,0.15)}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:24px}
    .modal.show{display:flex}
    .modal .dialog{width:95%;max-width:1000px;background:var(--card);border-radius:14px;padding:18px;display:grid;grid-template-columns:1fr 360px;gap:12px;max-height:90vh;overflow:auto}
    .modal .gallery{display:flex;gap:8px;flex-wrap:wrap}
    .modal img{width:100%;border-radius:10px}
    .itinerary{background:var(--glass);padding:10px;border-radius:10px}
    #map{height:300px;border-radius:10px}
    .planner{margin-top:18px;display:grid;grid-template-columns:1fr 320px;gap:12px}
    .day{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:10px;border-radius:10px;min-height:120px}
    .it-item{padding:8px;margin:6px 0;background:rgba(0,0,0,0.08);border-radius:8px;display:flex;justify-content:space-between;align-items:center}
    .blog-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-top:12px}
    footer{margin-top:28px;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent)}
    @media (max-width:900px){
      .hero{grid-template-columns:1fr;}
      .modal .dialog{grid-template-columns:1fr}
      .planner{grid-template-columns:1fr}
    }
    .btn{padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:#021018;cursor:pointer}
    .muted{color:var(--muted)}
    .small{font-size:13px}
  </style>
</head>
<body data-theme="dark">
  <div class="wrap">
    <header>
      <div class="brand"><div class="logo">W</div><div><strong>Wanderly Nepal</strong><div class="small muted">Explore Nepal — Trails, Peaks & Culture</div></div></div>
      <nav>
        <a href="#destinations">Destinations</a>
        <a href="#planner">Planner</a>
        <a href="#blog">Blog</a>
        <a href="#community">Community</a>
        <button id="themeToggle" title="Toggle theme" class="btn">Toggle</button>
      </nav>
    </header>

    <main>
      <section class="hero">
        <div class="hero-left card">
          <div class="slideshow" id="slideshow"></div>
          <div style="position:relative;padding:18px">
            <div class="searchbar">
              <input id="searchInput" placeholder="Search Nepal: Kathmandu, Pokhara, Everest, Annapurna..." />
              <button id="searchBtn" class="btn">Search</button>
            </div>
            <div id="searchResults" class="search-results" style="display:none"></div>
          </div>
        </div>

        <aside class="card">
          <h3>Top Picks — Nepal</h3>
          <div class="quick-links" id="quickLinks"></div>
          <hr style="margin:12px 0;border:none;height:1px;background:rgba(255,255,255,0.03)">
          <h4>Budget calculator (NPR)</h4>
          <div id="budgetCalc" class="small">
            <label>Flight (to KTM): <input id="fFlight" type="number" value="120000" /></label><br>
            <label>Hotel/night: <input id="fHotel" type="number" value="5000" /></label><br>
            <label>Nights: <input id="fNights" type="number" value="5" /></label><br>
            <label>Food/day: <input id="fFood" type="number" value="1500" /></label><br>
            <div style="margin-top:8px"><button id="calcBudgetBtn" class="btn">Estimate</button> <span id="budgetOutput" class="muted small"></span></div>
          </div>
          <hr style="margin:12px 0;border:none;height:1px;background:rgba(255,255,255,0.03)">
          <h4>Currency converter</h4>
          <div class="small">
            <input id="amount" type="number" value="10000" style="width:100px" />
            <select id="fromCur"><option>NPR</option><option>USD</option><option>EUR</option><option>GBP</option></select>
            →
            <select id="toCur"><option>USD</option><option>NPR</option><option>EUR</option><option>GBP</option></select>
            <div style="margin-top:8px"><button id="convBtn" class="btn">Convert</button> <span id="convOut" class="muted small"></span></div>
          </div>
        </aside>
      </section>

      <section id="destinations">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:18px">
          <h2>Top Destinations in Nepal</h2>
          <div class="filters">
            <select id="filterBudget"><option value="any">Any budget</option><option value="budget">Budget</option><option value="mid">Mid</option><option value="lux">Luxury</option></select>
            <select id="filterActivity"><option value="any">Any activity</option><option value="trekking">Trekking</option><option value="wildlife">Wildlife</option><option value="culture">Culture</option><option value="lake">Lake & Relax</option></select>
            <select id="filterSeason"><option value="any">Any season</option><option value="spring">Spring</option><option value="autumn">Autumn</option><option value="winter">Winter</option></select>
            <button id="resetFilters" class="btn">Reset</button>
          </div>
        </div>

        <div id="grid" class="grid"></div>
      </section>

      <section id="planner" style="margin-top:18px">
        <h2>Trip Planner</h2>
        <div class="planner">
          <div>
            <div class="card">
              <h3>Itinerary builder</h3>
              <p class="muted">Add attractions from destinations. Drag items across days to reorder.</p>
              <div id="attractionsList" class="small"></div>
            </div>
            <div style="margin-top:12px" class="card">
              <h3>Map overview</h3>
              <div id="map"></div>
            </div>
          </div>

          <aside>
            <div class="card">
              <h3>Your Itinerary</h3>
              <div id="daysContainer">
                <div class="day" id="day1"><strong>Day 1</strong><div class="items" data-day="1"></div></div>
                <div class="day" id="day2" style="margin-top:8px"><strong>Day 2</strong><div class="items" data-day="2"></div></div>
              </div>
              <div style="margin-top:12px"><button id="addDayBtn" class="btn">Add Day</button> <button id="clearItBtn" class="btn">Clear</button></div>
            </div>

            <div style="margin-top:12px" class="card">
              <h4>Community</h4>
              <div id="reviews"></div>
              <div style="margin-top:8px"><input id="revName" placeholder="Your name" style="width:100%"/><textarea id="revText" placeholder="Share a tip or short story" style="width:100%;margin-top:6px"></textarea><button id="postRev" class="btn" style="margin-top:6px">Post</button></div>
            </div>
          </aside>
        </div>
      </section>

      <section id="blog">
        <h2 style="margin-top:18px">From the Journal</h2>
        <div class="blog-grid" id="blogGrid"></div>
      </section>

      <section id="community" style="margin-top:18px">
        <h2>Community & Extras</h2>
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <div class="card" style="flex:1;min-width:280px">
            <h3>Collect Destinations</h3>
            <p class="muted small">Mark places in Nepal you've visited and collect badges.</p>
            <div id="collectList"></div>
          </div>

          <div class="card" style="flex:1;min-width:280px">
            <h3>Hidden Gems</h3>
            <ul id="gems" class="small muted"></ul>
          </div>
        </div>
      </section>

    </main>

    <footer>
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>&copy; 2025 Wanderly Nepal — Built with ❤️</div>
        <div class="muted small">Local demo — no backend. Data saved in your browser.</div>
      </div>
    </footer>
  </div>

  <div id="modal" class="modal" aria-hidden="true">
    <div class="dialog">
      <div>
        <div id="modalImages" class="gallery"></div>
        <h2 id="modalTitle"></h2>
        <p id="modalDesc" class="muted"></p>
        <h4>Top attractions</h4>
        <div id="modalAttractions"></div>
      </div>
      <aside>
        <div class="card">
          <h4>Quick info</h4>
          <div id="modalQuick"></div>
          <div style="margin-top:8px"><button id="visitBtn" class="btn">Mark visited</button> <button id="modalClose" class="btn">Close</button></div>
        </div>
        <div style="margin-top:12px" class="card">
          <h4>Weather</h4>
          <div id="weatherBox" class="muted small">Click the map for a live forecast (works when online).</div>
        </div>
      </aside>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script>
    // -------------------------
    // Nepal-focused dataset
    // -------------------------
    const DESTINATIONS = [
      {id:1,name:'Kathmandu Valley (Kathmandu & Bhaktapur)',slug:'kathmandu',img:'https://images.unsplash.com/photo-1549893076-6a4b5b4f8f7b?q=80&w=1200&auto=format&fit=crop',budget:'mid',activity:'culture',season:'autumn',lat:27.7172,lon:85.3240,desc:'Historic temples, Durbar Squares, bustling bazaars and rich Newar culture.',attractions:[{name:'Swayambhunath (Monkey Temple)'},{name:'Kathmandu Durbar Square'},{name:'Pashupatinath Temple'}]},
      {id:2,name:'Pokhara & Phewa Lake',slug:'pokhara',img:'https://images.unsplash.com/photo-1508264165352-cb0c0f3b3f97?q=80&w=1200&auto=format&fit=crop',budget:'mid',activity:'lake',season:'spring',lat:28.2096,lon:83.9856,desc:'Gateway to the Annapurna region, serene lakeside views and paragliding.',attractions:[{name:'Phewa Lake'},{name:'World Peace Pagoda'},{name:'Sarangkot sunrise view'}]},
      {id:3,name:'Chitwan National Park',slug:'chitwan',img:'https://images.unsplash.com/photo-1501706362039-c6e8090a9b3b?q=80&w=1200&auto=format&fit=crop',budget:'mid',activity:'wildlife',season:'winter',lat:27.5345,lon:84.3542,desc:'Jungle safaris, rhinos, and birdwatching in Nepal\'s lowlands.',attractions:[{name:'Elephant Safari'},{name:'Tharu Cultural Program'},{name:'Rapti River canoe trip'}]},
      {id:4,name:'Pokhara — Annapurna Base / Poon Hill',slug:'poonhill',img:'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1200&auto=format&fit=crop',budget:'mid',activity:'trekking',season:'autumn',lat:28.345,lon:83.006,desc:'Short treks with panoramic mountain views; ideal for sunrise vistas at Poon Hill.',attractions:[{name:'Poon Hill viewpoint'},{name:'Ghorepani village'},{name:'Annapurna foothills'}]},
      {id:5,name:'Everest Region (Lukla & EBC flights)',slug:'everest',img:'https://images.unsplash.com/photo-1518684079-6d7b7d4c9f1a?q=80&w=1200&auto=format&fit=crop',budget:'lux',activity:'trekking',season:'spring',lat:27.9861,lon:86.9226,desc:'World-famous treks, Himalayan vistas and Sherpa culture. Flights to Lukla start most journeys.',attractions:[{name:'Everest Base Camp Trek'},{name:'Tengboche Monastery'},{name:'Kala Patthar sunrise'}]},
      {id:6,name:'Lumbini (Birthplace of Buddha)',slug:'lumbini',img:'https://images.unsplash.com/photo-1523755231516-e43fd2e8dca5?q=80&w=1200&auto=format&fit=crop',budget:'budget',activity:'culture',season:'spring',lat:27.4845,lon:83.2765,desc:'UNESCO World Heritage site and a pilgrimage center with monasteries and the Maya Devi temple.',attractions:[{name:'Maya Devi Temple'},{name:'World Peace Pagoda (Lumbini)'},{name:'Sacred Garden'}]},
      {id:7,name:'Mustang (Upper Mustang / Lo Manthang)',slug:'mustang',img:'https://images.unsplash.com/photo-1536514798726-8b9a1e1f0b9b?q=80&w=1200&auto=format&fit=crop',budget:'lux',activity:'trekking',season:'autumn',lat:28.9956,lon:83.9648,desc:'Ancient Tibetan-influenced kingdom with dramatic desert landscapes and caves.',attractions:[{name:'Lo Manthang'},{name:'Charang Monastery'},{name:'Mustang caves'}]},
      {id:8,name:'Bandipur & Hill Towns',slug:'bandipur',img:'https://images.unsplash.com/photo-1526498460520-4c246339dccb?q=80&w=1200&auto=format&fit=crop',budget:'budget',activity:'culture',season:'spring',lat:27.9519,lon:84.4523,desc:'Quaint hill town with preserved Newari architecture and panoramic Annapurna views.',attractions:[{name:'Tundikhel viewpoint'},{name:'Hike to Siddha Cave'},{name:'Stroll historic bazaar'}]}
    ];

    const BLOGS = [
      {title:'Best time to trek in Nepal: a season-by-season guide',excerpt:'Which months give the clearest mountain views and safest trails.'},
      {title:'Local eats: Momo & Dal Bhat — where to try them in Kathmandu',excerpt:'A quick foodie tour of Kathmandu’s best affordable eats.'},
      {title:'Packing for a Himalayan trek: essentials that matter',excerpt:'What to bring for altitude, cold nights and long days on the trail.'}
    ];

    const GEMS = ['Sunrise at Poon Hill (less crowded route)','Hidden tea house near Dhampus','A quiet viewpoint above Bandipur for Annapurna panoramas'];

    // -------------------------
    // Utilities & UI
    // -------------------------
    function el(q){return document.querySelector(q)}
    function els(q){return Array.from(document.querySelectorAll(q))}

    // Theme toggle
    const themeToggle = el('#themeToggle');
    themeToggle.addEventListener('click',()=>{
      const current = document.body.getAttribute('data-theme');
      document.body.setAttribute('data-theme', current === 'dark' ? 'light' : 'dark');
    });

    // Hero slides focused on Nepal
    const slides = [
      'https://images.unsplash.com/photo-1508264165352-cb0c0f3b3f97?q=80&w=1600&auto=format&fit=crop', // Pokhara
      'https://images.unsplash.com/photo-1518684079-6d7b7d4c9f1a?q=80&w=1600&auto=format&fit=crop', // Everest region
      'https://images.unsplash.com/photo-1501706362039-c6e8090a9b3b?q=80&w=1600&auto=format&fit=crop' // Chitwan-like
    ];
    const slideshow = el('#slideshow');
    slides.forEach((src,i)=>{const d = document.createElement('div');d.className='slide';d.style.backgroundImage=`url(${src})`; if(i===0)d.classList.add('show');slideshow.appendChild(d)});
    let si=0; setInterval(()=>{const s=els('.slide'); s[si].classList.remove('show'); si=(si+1)%s.length; s[si].classList.add('show');},4500);

    // Quick links
    const quickLinks = el('#quickLinks');
    DESTINATIONS.slice(0,6).forEach(d=>{const btn=document.createElement('button');btn.textContent=d.name;btn.addEventListener('click',()=>openModal(d.id));quickLinks.appendChild(btn)});

    // Render grid
    const grid = el('#grid');
    function renderGrid(list){grid.innerHTML='';list.forEach(d=>{
      const card=document.createElement('div');card.className='card-dest';
      card.innerHTML=`<img src="${d.img}" alt="${d.name}"><div class="card-body"><strong>${d.name}</strong><div class="muted small">${d.desc}</div><div class="tags"><span class="tag">${d.budget}</span><span class="tag">${d.activity}</span><span class="tag">${d.season}</span></div><div style="margin-top:8px"><button class="btn addView" data-id="${d.id}">View</button> <button class="btn" data-add="${d.id}">Add to map</button></div></div>`;
      grid.appendChild(card);
    })}
    renderGrid(DESTINATIONS);

    // Filters
    el('#filterBudget').addEventListener('change',applyFilters);
    el('#filterActivity').addEventListener('change',applyFilters);
    el('#filterSeason').addEventListener('change',applyFilters);
    el('#resetFilters').addEventListener('click',()=>{el('#filterBudget').value='any';el('#filterActivity').value='any';el('#filterSeason').value='any';applyFilters();});
    function applyFilters(){
      const b=el('#filterBudget').value; const a=el('#filterActivity').value; const s=el('#filterSeason').value;
      const out = DESTINATIONS.filter(d=> (b==='any'||d.budget===b) && (a==='any'||d.activity===a) && (s==='any'||d.season===s));
      renderGrid(out);
      attachGridHandlers();
    }

    // Search
    const searchInput=el('#searchInput');const searchResults=el('#searchResults');
    searchInput.addEventListener('input',()=>{
      const q=searchInput.value.trim().toLowerCase(); if(!q){searchResults.style.display='none';return}
      const matches = DESTINATIONS.filter(d=>d.name.toLowerCase().includes(q)).slice(0,6);
      searchResults.innerHTML = matches.map(m=>`<div class="small" style="padding:8px;cursor:pointer">${m.name}</div>`).join('');
      searchResults.style.display = matches.length? 'block':'none';
      Array.from(searchResults.children).forEach((c,i)=>c.addEventListener('click',()=>{openModal(matches[i].id);searchResults.style.display='none';searchInput.value=''}));
    });
    el('#searchBtn').addEventListener('click',()=>{const q=searchInput.value.trim().toLowerCase();const found=DESTINATIONS.find(d=>d.name.toLowerCase().includes(q));if(found)openModal(found.id);});

    // Modal
    const modal = el('#modal'); const modalTitle = el('#modalTitle'); const modalDesc = el('#modalDesc'); const modalImages = el('#modalImages'); const modalAttractions = el('#modalAttractions'); const modalQuick = el('#modalQuick'); const visitBtn = el('#visitBtn');
    let currentModalId = null;
    function openModal(id){const d = DESTINATIONS.find(x=>x.id===id); if(!d) return;
      currentModalId=id; modalTitle.textContent=d.name; modalDesc.textContent=d.desc; modalImages.innerHTML='';
      for(let i=0;i<3;i++){const img = document.createElement('img');img.src=d.img; img.style.height='120px'; modalImages.appendChild(img)}
      modalAttractions.innerHTML = d.attractions.map(a=>`<div style="padding:6px 0;display:flex;justify-content:space-between;align-items:center"><span>${a.name}</span><button class="btn small addToIt" data-name="${a.name}">Add to itinerary</button></div>`).join('');
      modalQuick.innerHTML = `<div class="small">Budget: ${d.budget}</div><div class="small">Activity: ${d.activity}</div><div class="small">Best season: ${d.season}</div>`;
      modal.classList.add('show');
    }
    el('#modalClose').addEventListener('click',()=>modal.classList.remove('show'));
    modal.addEventListener('click',(e)=>{if(e.target===modal)modal.classList.remove('show')});

    // Add to itinerary from modal
    document.addEventListener('click',e=>{
      if(e.target.classList.contains('addToIt')){
        const name = e.target.getAttribute('data-name'); addToItinerary(name);
      }
    });

    // Attach handlers to grid buttons
    function attachGridHandlers(){els('.card-dest .btn[data-add]').forEach(b=>b.addEventListener('click',()=>{const id=b.getAttribute('data-add');const d=DESTINATIONS.find(x=>x.id==id); map.panTo([d.lat,d.lon],{animate:true});L.marker([d.lat,d.lon]).addTo(map).bindPopup(d.name).openPopup();}));
      els('.card-dest .addView').forEach(b=>b.addEventListener('click',()=>openModal(Number(b.getAttribute('data-id')))));
    }
    attachGridHandlers();

    // Itinerary builder
    const attractionsList=el('#attractionsList');
    function refreshAttractions(){
      attractionsList.innerHTML = DESTINATIONS.flatMap(d=>d.attractions.map(a=>({dest:d.name,name:a.name,lat:d.lat,lon:d.lon}))).map((a,i)=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0"><div><strong>${a.name}</strong><div class="small muted">${a.dest}</div></div><div><button class="btn addIt" data-name="${a.name}" data-lat="${a.lat}" data-lon="${a.lon}">Add to itinerary</button></div></div>`).join('');
      Array.from(attractionsList.querySelectorAll('.addIt')).forEach(b=>b.addEventListener('click',()=>addToItinerary(b.getAttribute('data-name'),b.getAttribute('data-lat'),b.getAttribute('data-lon'))));
    }
    refreshAttractions();

    function addToItinerary(name,lat,lon){
      const target = el('.items'); // first day
      const item = document.createElement('div'); item.className='it-item'; item.draggable=true; item.textContent = name; const remove = document.createElement('button'); remove.textContent='✕'; remove.className='small'; remove.style.marginLeft='8px'; remove.addEventListener('click',()=>item.remove()); item.appendChild(remove);
      item.addEventListener('dragstart',dragStart);
      target.appendChild(item);
      if(lat && lon){L.marker([lat,lon]).addTo(map).bindPopup(name)}
    }

    // Drag/drop
    function dragStart(e){e.dataTransfer.setData('text/plain','dragging'); e.dataTransfer.effectAllowed='move'; window.draggingEl = e.target;}
    document.addEventListener('dragover',e=>{ if(e.target.classList.contains('items') || e.target.classList.contains('day')) e.preventDefault(); });
    document.addEventListener('drop',e=>{ if(e.target.classList.contains('items') || e.target.closest('.items')){ e.preventDefault(); const items = e.target.classList.contains('items')? e.target : e.target.closest('.items'); if(window.draggingEl) items.appendChild(window.draggingEl); }});

    // Days
    el('#addDayBtn').addEventListener('click',()=>{const days = el('#daysContainer'); const n = days.querySelectorAll('.day').length + 1; const d = document.createElement('div'); d.className='day'; d.innerHTML = `<strong>Day ${n}</strong><div class="items" data-day="${n}"></div>`; days.appendChild(d);Array.from(d.querySelectorAll('.items')).forEach(i=>i.addEventListener('dragover',e=>e.preventDefault()));});
    el('#clearItBtn').addEventListener('click',()=>{els('.items').forEach(i=>i.innerHTML='')});

    // Map centered on Nepal
    const map = L.map('map',{center:[28.2,84.0],zoom:7});
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'© OpenStreetMap contributors'}).addTo(map);
    DESTINATIONS.forEach(d=>{L.marker([d.lat,d.lon]).addTo(map).bindPopup(d.name)});

    // Modal mark visited
    visitBtn.addEventListener('click',()=>{
      const id = currentModalId; const d = DESTINATIONS.find(x=>x.id===id); if(!d) return;
      const visited = JSON.parse(localStorage.getItem('visited')||'[]'); if(!visited.includes(d.id)){visited.push(d.id); localStorage.setItem('visited',JSON.stringify(visited)); alert('Marked visited — added to your collection!'); renderCollect();}
    });

    // Reviews
    function renderReviews(){const container=el('#reviews'); const r = JSON.parse(localStorage.getItem('reviews')||'[]'); container.innerHTML = r.map(rr=>`<div style="padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.02)"><strong>${rr.name}</strong><div class="small muted">${rr.text}</div></div>`).join('');}
    el('#postRev').addEventListener('click',()=>{const n=el('#revName').value||'Anonymous'; const t=el('#revText').value; if(!t) return alert('Write something!'); const r = JSON.parse(localStorage.getItem('reviews')||'[]'); r.unshift({name:n,text:t}); localStorage.setItem('reviews',JSON.stringify(r)); el('#revName').value=''; el('#revText').value=''; renderReviews();});
    renderReviews();

    // Budget calc (NPR)
    el('#calcBudgetBtn').addEventListener('click',()=>{
      const f=Number(el('#fFlight').value||0); const h=Number(el('#fHotel').value||0); const n=Number(el('#fNights').value||1); const fd=Number(el('#fFood').value||0);
      const total = f + (h*n) + (fd*n) + 5000; el('#budgetOutput').textContent = 'Estimated: NPR '+Math.round(total);
    });

    // Currency convert
    async function convert(amount,from,to){
      try{
        const r = await fetch(`https://api.exchangerate.host/convert?from=${from}&to=${to}&amount=${amount}`);
        const j = await r.json(); return j.result;
      }catch(e){
        const mock = {USD:1,NPR:132,EUR:0.92,GBP:0.79};
        return Math.round((amount*(mock[to]/mock[from]))*100)/100;
      }
    }
    el('#convBtn').addEventListener('click',async()=>{const a=Number(el('#amount').value||0);const f=el('#fromCur').value;const t=el('#toCur').value; el('#convOut').textContent='...'; const res = await convert(a,f,t); el('#convOut').textContent = res + ' ' + t;});

    // Blog render
    function renderBlog(){el('#blogGrid').innerHTML = BLOGS.map(b=>`<div class="card"><h3>${b.title}</h3><div class="muted small">${b.excerpt}</div><div style="margin-top:8px"><button class="btn">Read</button></div></div>`).join('');}
    renderBlog();

    // Collect list
    function renderCollect(){const out = el('#collectList'); const visited = JSON.parse(localStorage.getItem('visited')||'[]'); out.innerHTML = DESTINATIONS.map(d=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0"><div><strong>${d.name}</strong><div class="small muted">${d.desc}</div></div><div><button class="btn collectBtn" data-id="${d.id}">${visited.includes(d.id)?'Visited':'Mark visited'}</button></div></div>`).join(''); Array.from(out.querySelectorAll('.collectBtn')).forEach(b=>b.addEventListener('click',()=>{const id=Number(b.getAttribute('data-id')); const v=JSON.parse(localStorage.getItem('visited')||'[]'); if(!v.includes(id)){v.push(id); localStorage.setItem('visited',JSON.stringify(v)); renderCollect();}}));}
    renderCollect();

    // Gems
    el('#gems').innerHTML = GEMS.map(g=>`<li>${g}</li>`).join('');

    // Search keyboard
    searchInput.addEventListener('keydown',e=>{ if(e.key==='Enter'){ el('#searchBtn').click(); } });

    // Map weather on click
    map.on('click',async function(e){ const lat=e.latlng.lat; const lon=e.latlng.lng; try{ const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`); const j=await res.json(); el('#weatherBox').innerHTML = `<div>Temp: ${j.current_weather.temperature}°C — Wind: ${j.current_weather.windspeed} m/s</div><div class="small muted">Data from Open-Meteo</div>`;}catch(err){el('#weatherBox').innerHTML='<div class="muted">Unable to fetch weather. Try again when online.</div>'}});

    // Init
    const observer = new MutationObserver(()=>attachGridHandlers()); observer.observe(grid,{childList:true,subtree:true});
    window.addEventListener('load',()=>{attachGridHandlers(); renderCollect(); renderReviews();});
  </script>
</body>
</html>
